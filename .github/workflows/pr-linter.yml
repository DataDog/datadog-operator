name: pull request linter
on:
  pull_request_target:
   types: [opened, labeled, unlabeled, synchronize]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Check out code into the Go module directory
      uses: actions/checkout@v1
    - name: Verify Pull Request Labels
      uses: jesusvasquez333/verify-pr-label-action@v1.3.1
      with:
        github-token: '${{ secrets.GITHUB_TOKEN }}'
        valid-labels: 'bug, enhancement, refactoring, documentation, tooling, dependencies'
        pull-request-number: '${{ github.event.pull_request.number }}'
  check-milestone:
    uses: actions/github-script@latest
    with:
      script: |
        const result = github.rest.issues.get({
          owner: context.repo.owner,
          repo: context.repo.repo,
          issue_number: context.issue.number,
        });
        if ((!result.milestone || !result.milestone.title) && (!result.labels.some(e => e.name === "qa/skip-qa"))) {
          console.error(`::error::Missing milestone or \`qa/skip-qa\` label`);
        }
